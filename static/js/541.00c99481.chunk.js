"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[541],{6075:(e,t,o)=>{o.d(t,{A:()=>a});o(5043);var n=o(4005),s=o(579);const a=e=>{let{variant:t="info",message:o,show:a=!0,className:r=""}=e;return a?(0,s.jsx)(n.A,{variant:t,className:r,children:o}):null}},1358:(e,t,o)=>{o.d(t,{A:()=>l});o(5043);var n=o(8012),s=(o(4119),o(3637)),a=o(1397),r=o(4675),i=o(579);const l=e=>{let{onDrop:t}=e;const{handleDrop:o}=(0,n.A)(),{performSearch:l}=(0,r.A)(),c=t||o;return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"droppable-container mt-4",children:[(0,i.jsx)(s.A,{style:{width:"90px",height:"90px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,i.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,i.jsxs)("div",{className:"divider-container",children:[(0,i.jsx)("hr",{className:"divider"}),(0,i.jsx)("span",{className:"divider-text",children:"or"}),(0,i.jsx)("hr",{className:"divider"})]}),(0,i.jsx)(a.A,{onSearch:e=>{l(e,{title:"Search",role:"",mode:"furtive",default_with_precond:!0,precond:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/Raw_Material" OR flattenedtaxonomies:"types/Document"',show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"},(e=>{e&&e.length>0&&e[0].id?c([{objectId:e[0].id,objectType:e[0]["ds6w:type_value"]}]):console.warn("No objectId found in selected objects")}))}})]})})}},6313:(e,t,o)=>{o.d(t,{A:()=>r});o(5043);var n=o(4104),s=o(4282),a=o(579);const r=e=>{let{show:t,onHide:o,title:r,children:i,footerButtons:l}=e;return(0,a.jsxs)(n.A,{show:t,onHide:o,size:"lg",centered:!0,children:[(0,a.jsx)(n.A.Header,{closeButton:!0,children:(0,a.jsx)(n.A.Title,{children:r||"Modal Title"})}),(0,a.jsx)(n.A.Body,{children:i}),(0,a.jsx)(n.A.Footer,{children:l?l.map(((e,t)=>(0,a.jsx)(s.A,{variant:e.variant||"secondary",onClick:e.onClick,children:e.label},t))):(0,a.jsx)(s.A,{variant:"secondary",onClick:o,children:"Close"})})]})}},8278:(e,t,o)=>{o.d(t,{A:()=>r});o(5043);var n=o(6313),s=o(6075),a=o(579);const r=e=>{let{show:t,onHide:o,onConfirm:r}=e;return(0,a.jsx)(n.A,{show:t,onHide:o,title:"Confirm Submission",footerButtons:[{label:"Cancel",variant:"danger",onClick:o},{label:"Submit",variant:"success",onClick:r}],children:(0,a.jsxs)("div",{className:"confirmation-modal-content",children:[(0,a.jsx)("h4",{className:"confirmation-title",children:"Are you sure you want to submit? This action cannot be undone."}),(0,a.jsx)(s.A,{variant:"info",className:"mb-3",message:(0,a.jsxs)("span",{className:"info-message-container",children:[(0,a.jsx)("span",{className:"info-icon",children:"i"}),(0,a.jsx)("span",{className:"info-text",children:"Once submitted, your data will be processed by the system. You will receive a confirmation once its complete. Large uploads may take a few minutes."})]})})]})})}},3353:(e,t,o)=>{o.d(t,{A:()=>u});var n=o(5043),s=o(6313),a=o(7348),r=o(6047),i=o(6075),l=o(3728),c=o(579);const d=e=>{let{errors:t}=e;const o=(0,n.useMemo)((()=>{const e=t.reduce(((e,t)=>{const o=t.match(/Row (\d+):/),n=t.match(/"([^"]*)" (?:is required|value)/),s=t.split(": ").slice(1).join(": "),a=o?o[1]:"N/A",r=n?n[1]:t.includes("Collaborative Space","Quantity")?"Collaborative Space":"N/A";return e[a]||(e[a]={rowNumber:a,columns:[],errors:[]}),e[a].columns.push(r),e[a].errors.push(s||t),e}),{});return Object.values(e).sort(((e,t)=>Number(e.rowNumber)-Number(t.rowNumber)))}),[t]),s=new a.jS({fixedWidth:!0,defaultHeight:50}),d=e=>{let{key:t,index:n,style:r,parent:i}=e;const l=o[n];return(0,c.jsx)(a.dl,{cache:s,columnIndex:0,rowIndex:n,parent:i,children:(0,c.jsxs)("div",{style:r,className:"table-row",children:[(0,c.jsx)("div",{className:"table-cell",style:{width:"15%"},children:l.rowNumber}),(0,c.jsx)("div",{className:"table-cell",style:{width:"25%"},children:l.columns.map(((e,t)=>(0,c.jsx)("div",{children:e},t)))}),(0,c.jsx)("div",{className:"table-cell",style:{width:"60%"},children:(0,c.jsx)("ul",{className:"error-list",children:l.errors.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))})})]})},t)};return(0,c.jsxs)("div",{className:"error-popup-container",children:[(0,c.jsxs)("div",{className:"error-header-container",children:[(0,c.jsx)("div",{}),(0,c.jsx)(l.A,{variant:"success",onClick:()=>{const e=o.map((e=>({"Row Number":e.rowNumber,"Column Names":e.columns.join(", "),"Error Description":e.errors.join("; ")})));(0,r.E1)(e,"validation-errors.xlsx")},className:"mb-3",text:"Export to Excel",size:"lg"})]}),(0,c.jsx)(i.A,{variant:"danger",message:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("strong",{children:"\u26a0\ufe0f Note:"})," Below reports show only uploaded spreadsheet error rows. To resolve these issues, update the spreadsheet and re-import. (",o.length," errors found)"]}),className:"custom-alert"}),(0,c.jsxs)("div",{className:"table-wrapper",children:[(0,c.jsxs)("div",{className:"static-header",children:[(0,c.jsx)("div",{className:"header-cell",style:{width:"15%"},children:"Row Number"}),(0,c.jsx)("div",{className:"header-cell",style:{width:"25%"},children:"Column Name"}),(0,c.jsx)("div",{className:"header-cell",style:{width:"60%"},children:"Error Description"})]}),(0,c.jsx)("div",{className:"table-container",children:(0,c.jsx)(a.t$,{children:e=>{let{height:t,width:n}=e;return(0,c.jsx)(a.B8,{width:n,height:t,rowCount:o.length,rowHeight:s.rowHeight,deferredMeasurementCache:s,rowRenderer:d})}})})]})]})},u=e=>{let{show:t,onHide:o,errors:n}=e;return console.log("[ContentErrorsModal.jsx] errors:",n),(0,c.jsx)(s.A,{show:t,onHide:o,title:"Content Errors",footerButtons:[{label:"Close",variant:"danger",onClick:o}],children:(0,c.jsx)(d,{errors:n})})}},5362:(e,t,o)=>{o.d(t,{A:()=>c});var n=o(5043),s=o(8931),a=o(7111),r=o(3277),i=o(2725),l=o(579);const c=(0,n.forwardRef)(((e,t)=>{let{data:o,columns:c,addedItem:d,CAName:u,state:m}=e;const{showWarningToast:p}=(0,i.A)(),[g,h]=(0,n.useState)({});(0,n.useEffect)((()=>{h({})}),[o]);const f=()=>{const e=b.getSelectedRowModel().rows.map((e=>e.original["Available Plant"]));0!==e.length?(d(e),h({})):p(r.e1)};(0,n.useImperativeHandle)(t,(()=>({addPlant:f})));const w=(0,n.useMemo)((()=>[{id:"select",cell:e=>{let{row:t}=e;return(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.getIsSelected(),onChange:t.getToggleSelectedHandler()})}},...c]),[c]),b=(0,s.N4)({data:o,columns:w,state:{rowSelection:g},enableRowSelection:!0,onRowSelectionChange:h,getCoreRowModel:(0,a.HT)()});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{type:"button",className:"btn btn-outline-primary me-3",onClick:()=>{b.getRowModel().rows.forEach((e=>e.toggleSelected(!0)))},children:"Select All"}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{b.getRowModel().rows.forEach((e=>e.toggleSelected(!1)))},children:"Deselect All"})]}),b.getRowModel().rows.length>0?(0,l.jsx)("div",{className:"overflow-auto",style:{maxHeight:"60vh"},children:b.getRowModel().rows.map((e=>(0,l.jsxs)("div",{className:"p-3 border-bottom d-flex align-items-center",style:{backgroundColor:e.getIsSelected()?"#d5e8f2":"inherit"},children:[(0,l.jsx)("div",{className:"me-3",children:(0,s.Kv)(e.getVisibleCells()[0].column.columnDef.cell,e.getVisibleCells()[0].getContext())}),(0,l.jsx)("div",{children:e.original[c[0].accessorKey]})]},e.id)))}):(0,l.jsx)("p",{className:"text-muted p-3",children:"No data available"})]})}))},1052:(e,t,o)=>{o.r(t),o.d(t,{default:()=>U});var n=o(5043),s=o(4391),a=(o(2342),o(9555),o(3003)),r=o(2670),i=o(2115),l=(o(8421),o(4050),o(9959),o(174)),c=o(2725),d=o(3277),u=o(6713),m=o(5645),p=o(6047);var g=o(9379);o(9722);const h="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",f=[];async function w(e,t){const o="".concat(h,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const t=await(0,p.ui)("GET",o,"",e);return t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].title||null}catch(n){return console.error("Error fetching plant title for class ID ".concat(t,":"),n),null}}async function b(e,t){try{const o=await async function(e,t){const o="".concat(h,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const t=await(0,p.ui)("GET",o,"",e);return console.log("Response from Plant Class IDs URL:",t),console.log("Response totalItems:",t.output.totalItems),t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].ClassificationAttributes&&Array.isArray(t.output.member[0].ClassificationAttributes.member)?t.output.member[0].ClassificationAttributes.member.filter((e=>{const t=(e.Attributes||[]).find((e=>"PlantAssignmentClass"===e.name));return t&&!0===t.value})).map((e=>e.ClassID)):[]}catch(n){return console.error("Error fetching plant class IDs for ".concat(t,":"),n),[]}}(e,t);if(0===o.length)return[];const n=[];for(const t of o){const o=f.find((e=>e.classid===t));if(o)n.push(o.title);else{const o=await w(e,t);o&&(f.push({classid:t,title:o}),n.push(o))}}return n}catch(o){return console.error("Error fetching assigned plants for ".concat(t,":"),o),[]}}async function v(e,t){const o="".concat(h,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"/expand"),n={expandDepth:1,withPath:!0};try{const t=await(0,p.ui)("POST",o,n,e);if(t.status&&t.output&&Array.isArray(t.output.member)){const o=t.output.member.filter((e=>e.type&&"DELFmiFunctionIdentifiedInstance"!==e.type));return await Promise.all(o.map((async t=>{const o=await b(e,t.id);return{id:t.id,type:t.type,name:t.name,title:t.title||null,AssignedPlants:o}})))}return[]}catch(s){return console.error("Error fetching children for identifier ".concat(t,":"),s),[]}}async function A(e,t,o){try{const n=await async function(e,t){const o="".concat(h,"/resources/v1/modeler/dsmfg/invoke/dsmfg:getMfgItemsFromEngItem"),n=[t];try{const t=await(0,p.ui)("POST",o,n,e);return t.output.totalItems>0&&Array.isArray(t.output.member)?t.output.member.map((e=>e.identifier)):[]}catch(s){return console.error("Error fetching manufacturing items:",s),[]}}(e,o);if(console.log("Manufacturing Identifiers:",n),0===n.length)return[];const s=await Promise.all(n.map((t=>async function(e,t){const o="".concat(h,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"?$mask=dsmfg:MfgItemMask.Details");try{const t=await(0,p.ui)("GET",o,"",e);if(console.log("Response from Manufacturing Item URL:",t),console.log("Response totalItems:",t.output.totalItems),console.log("Response member:",t.output.member),t&&t.output&&t.output.totalItems>0&&Array.isArray(t.output.member)&&t.output.member.length>0){const e=t.output.member[0];return console.log("item:",e),{identifier:e.id,name:e.name,title:e.title,type:e.type,createdFrom:e.createdFrom||null}}return null}catch(n){return console.error("Error fetching details for identifier ".concat(t,":"),n),null}}(e,t))));console.log("Manufacturing Details:",s);const a=s.filter((e=>null!==e)),r=new Set(a.map((e=>e.createdFrom)).filter(Boolean).map((e=>e.split(" ")[0])));console.log("Created From Set:",r);const i=[];for(const o of a){const n=r.has(o.name),s=o.identifier===t;console.log("Processing item: ".concat(o.name,", isParent: ").concat(n,", currentObject: ").concat(s));const a=await b(e,o.identifier);console.log("Assigned Plants for Hello:",a);let l=[];(n||s)&&(l=await v(e,o.identifier)),i.push({identifier:o.identifier,name:o.name,title:o.title,type:o.type,isParent:n,currentObject:s,AssignedPlants:a,children:l})}return console.log("Prepared Data Output:",i),i}catch(n){return console.error("Error in prepareDataOutput:",n),[]}}const y=async()=>{try{let e=window.widget.getValue("Credentials");const t=await(0,p.fV)();console.log("Security Context is:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",n=await new Promise(((e,n)=>{t.authenticatedRequest(o,{method:"GET",type:"json",onComplete:e,onFailure:n})})),s=n.csrf.name,a=n.csrf.value,r="SecurityContext",i=e;return{[s]:a,[r]:i}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}},C="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",j=()=>{const{showErrorToast:e}=(0,c.A)(),t=(0,a.wA)();let o=window.widget.getValue("email");console.log("Email in usePlantAssignment:",o);return{handleCompanion:async(o,n,s,a)=>{try{t((0,m.Ve)(!0));const o=await y();if(!o)return void e(d.rK);console.log("[UsePlantAssignment] Headers:",o);if("Change Action"===a){console.log("The object Type is Change Action")}else{let e=[];const a=await x(s,o);if(console.log("[Use Companion] Scope Linked Data:",a),a.identifier){e=await async function(e,t){const o="".concat(C,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const a=await(0,p.ui)("GET",o,"",e);if(a.status&&a.output){var n;const t=(null===(n=a.output.member[0].ClassificationAttributes)||void 0===n?void 0:n.member)||[],o=[];for(const n of t){var s;const t=n.ClassID,a=n.Attributes||[];if(null===(s=a.find((e=>"PlantAssignmentClass"===e.name)))||void 0===s?void 0:s.value){const n=await N(e,t);o.push({id:t,title:n})}}return o}return console.log("No valid response for object ID ".concat(t)),[]}catch(a){return console.error("Error fetching item details for ".concat(t,":"),a),[]}}(o,a.identifier);const n=await A(o,s,a.identifier);console.log("[Use Companion] Prepare Data Output:",n),t((0,m.TO)(n));const r=await async function(e,t){const o=t.map((e=>e.title));console.log("Engineering Item Plants:",o);const n=e.find((e=>!0===e.currentObject));if(!n)return console.warn("Current MFG item not found in prepared data output."),{AssignedPlants:[],AvailablePlants:o};const s=n.AssignedPlants||[],a=[];e.forEach((e=>{e.isParent||(e.AssignedPlants||[]).forEach((e=>{a.includes(e)||a.push(e)}))}));const r=o.filter((e=>!a.includes(e)));return console.log("Assigned Plants:",s),console.log("Available Plants:",r),{AssignedPlants:s,AvailablePlants:r}}(n,e);console.log("[Use Companion] Plant Lists:",r),t((0,m.AH)({initialAssignedPlants:r.AssignedPlants,uniquePlants:r.AvailablePlants}))}const r=await(async(e,t,o)=>{const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let s=!1,a=[],r={CAName:"",CAStatus:""};const i=["caproposedwhere_from","carealizedwhere_from"],l="".concat(n,"/resources/enorelnav/v2/navigate/setPreferences");let c={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from","carealizedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier","ds6w:label"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},d="".concat(n,"/resources/enorelnav/v2/navigate/getEcosystem"),u={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[t]};try{console.log("[Get CA Details] Product ID:",t);const m=await(0,p.fV)(),h=await new Promise(((t,o)=>{m.authenticatedRequest(l,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(c),type:"json",onComplete:t,onFailure:o})}));if(console.log("[Get CA Details Service] Data received:",h),"OK"===h.status){const l=await new Promise(((t,o)=>{m.authenticatedRequest(d,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(u),type:"json",onComplete:t,onFailure:o})}));console.log("[Get CA Details Service] Data received:",l);for(const c of i)l.objectsByPatterns[c]&&await Promise.all(l.objectsByPatterns[c].map((async i=>{const l=i["ds6w:status"].slice(14),d=i["ds6w:label"];if("Complete"!==l){const u="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(i.id,"?$fields=proposedChanges,realizedChanges,flowDown"),p=await new Promise(((t,o)=>{m.authenticatedRequest(u,{method:"GET",headers:e,type:"json",onComplete:t,onFailure:o})}));console.log("response3 Data will appear:",p),"caproposedwhere_from"===c?Array.isArray(p.proposedChanges)&&p.proposedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.whats[0].what})})):Array.isArray(p.realizedChanges)&&p.realizedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.operations[0]})})),s="released"!==o.toLowerCase()||a.some((e=>e.identifier===t&&"Modify"===e.action)),s&&(r.CAName=d,r.CAStatus=l)}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",s),{success:!0,data:s,CAData:r,proposedChanges:a}}catch(m){throw console.error("Failed Request:",{url:l,headers:e,body:c,error:m}),m}})(o,s,n);console.log("[Use Plant Assignment] CA Details:",r),r.success&&t((0,m.zY)(r.data)),console.log("[Plant Assignment] All services executed successfully.")}}catch(r){console.error("[Plant Assignment] Error:",r),e("An error occurred while fetching plant assignment data.")}finally{t((0,m.Ve)(!1))}}}};async function x(e,t){let o="";o="".concat(C,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(e,"/dsmfg:ScopeEngItem");try{const n=await(0,p.ui)("GET",o,"",t);return n.status&&n.output?{identifier:n.output.member[0].ScopeEngItem.identifier,type:n.output.member[0].ScopeEngItem.type}:(console.log("No valid response for identifier ".concat(e)),{})}catch(n){return console.error("Error fetching item details for ".concat(e,":"),n),{}}}async function N(e,t){const o="".concat(C,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const n=await(0,p.ui)("GET",o,"",e);if(n.status&&n.output&&n.output.member&&n.output.member.length>0){return n.output.member[0].title||null}return console.log("No class found for classId ".concat(t)),null}catch(n){return console.error("Error fetching class title for classId ".concat(t,":"),n),null}}var D=o(314);const P=()=>{const{showErrorToast:e}=(0,c.A)(),{handleCompanion:t}=j(),o=(0,a.d4)((e=>e.droppedObject.isDropped)),s=(0,a.d4)((e=>e.droppedObject.loading)),r=(0,a.wA)(),i=(0,n.useCallback)((async o=>{try{const a=await(0,D.Sj)({dataItems:o});if(a.success){r((0,m.um)({cardData:a.data.cardData}));const e=a.data.cardData;var n,s;if(console.log("[Dragged Items are]",e),r((0,m.Rr)(!0)),a)await t(e["Collaborative Space"],e["Maturity State"],null===(n=o[0])||void 0===n?void 0:n.objectId,null===(s=o[0])||void 0===s?void 0:s.objectType)}else e(d.wX)}catch(a){console.error("[FetchObjectDetails] Error fetching details:",a),e(d.wX)}finally{r((0,m.r1)(!1))}}),[r,t]),l=(0,n.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var o;const n=null===(o=t[0])||void 0===o?void 0:o.objectType;if(!["CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide"].includes(n))return void e(d.$E);r((0,m.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),r((0,m.r1)(!1)),setTimeout((()=>r((0,m.r1)(!0))),0),await i(t)}else console.warn("[handleDrop] No data items to process.")}catch(n){console.error("[Drop] Error in handleDrop:",n),r((0,m.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(d.nz)}}),[i,e]);return{initializeDroppableArea:(0,n.useCallback)((()=>{o?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),r((0,m.Rr)(!1)));const t=setInterval((()=>{const o=document.querySelector(".droppable-container");o&&(clearInterval(t),(0,D.pn)(o,l,r,e))}),100);return()=>clearInterval(t)}),[l,r]),loading:s,handleDrop:l}};var S=o(579);const E=()=>{const{handleDrop:e}=P(),{showSuccessToast:t,showErrorToast:o}=(0,c.A)(),[s,a]=(0,n.useState)(!1);console.log("---[WidgetLifecycle]--- starts");return(0,n.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var n,s;const i=(new Error).stack.split("\n"),c=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(i)&&!c)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),a(!0);const u=r.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===u||void 0===u||null===(n=u.data)||void 0===n||null===(s=n.items)||void 0===s||!s.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",u),void a(!1);try{await(0,l.M)(u.data.items,e)}catch(m){console.error("[WidgetLifecycle] \u274c Error during refresh:",m),o(d.H6)}finally{a(!1),t(d._l)}}))}),[]),s?(0,S.jsx)(u.A,{}):null};o(4816);var I=o(3637),R=o(768),T=o(759),k=o(8278);const O=[{accessorKey:"Available Plant",header:"Available Plant"}];var M=o(5362),F=o(6313);o(3728);const _=e=>{let{onAddPlant:t,addedPlant:o,onSave:s,onRemove:a,uniquedata:r,uniqueColumn:i,CAName:l,state:u,type:m,hasChanges:p,onCancel:g,setHasChanges:h}=e;const{showWarningToast:f,showSuccessToast:w}=(0,c.A)(),[b,v]=(0,n.useState)(!1),A=(0,n.useRef)();console.log("[Unique Table Data]:",r);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"d-flex cta-absolute",children:[(0,S.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{"Change Action"===m||l?v(!0):f("RELEASED"===u?d.sL:d.Ru)},children:"Add Plant"}),(0,S.jsx)("button",{className:"btn btn-outline-danger btn-lg m-2",onClick:()=>{a&&a()},children:"Remove"})]}),(0,S.jsx)(F.A,{show:b,onHide:()=>v(!1),title:"Available Plant",footerButtons:[{label:"Add",variant:"primary",onClick:()=>{var e;null===(e=A.current)||void 0===e||e.addPlant(),v(!1)}},{label:"Close",variant:"danger",onClick:()=>v(!1)}],children:(0,S.jsx)("div",{className:"modal-body",children:(0,S.jsx)(M.A,{ref:A,data:r,columns:i,CAName:l,addedItem:e=>{console.log(e),o(e),h&&h(!0)},state:u})})})]})};o(3353),o(9332);o(3910);var L=o(1358);const H=()=>{const{showSuccessToastWithProgress:e,showErrorToastWithProgress:t}=(0,c._)(),[o,s]=(0,n.useState)(!1),{initializeDroppableArea:r,loading:i}=P(),[l,d]=(0,n.useState)(0),[p,h]=(0,n.useState)([]),[f,w]=(0,n.useState)([]),[b,v]=(0,n.useState)([]),[A,C]=(0,n.useState)([]),{handleDrop:j}=P(),[x,N]=(0,n.useState)(!1),[D,E]=(0,n.useState)(!1),[M,F]=(0,n.useState)(!1),[H,q]=(0,n.useState)(!1),U=(0,a.wA)(),[z,B]=(0,n.useState)([]),[G,W]=(0,n.useState)(!1);let V=window.widget.getValue("Credentials");console.log("Security context is: ",V);console.log("Table Data after Adding:",p);const K=(0,a.d4)((e=>e.droppedObject.selectedTableRows));(0,n.useEffect)((()=>{K.length>0&&W(!0)}),[K]);const J=(0,a.d4)((e=>e.droppedObject.droppedObjectData));console.log("droppedObjectData",J);const $=(0,a.d4)((e=>e.droppedObject.loadingParentDetails));console.log("Parents Loading State:",$);const X=(0,a.d4)((e=>e.droppedObject.isDropped)),Y=(0,a.d4)((e=>e.droppedObject.CompanionObjectData.uniquePlants));console.log("[Plant Assignment] Unique Plants:",Y);const Q=(0,a.d4)((e=>e.droppedObject.CompanionObjectData.initialAssignedPlants));console.log("The Assigned Plants are:",Q);const Z=(0,a.d4)((e=>e.droppedObject.CompanionObjectData.CAName));if((0,n.useEffect)((()=>{v(Y)}),[Y]),(0,n.useEffect)((()=>{p.length>=0&&d((e=>e+1))}),[p]),J.cardData&&J.initialDraggedData)var ee,te,oe=J.cardData["Maturity State"],ne=null===(ee=J.initialDraggedData)||void 0===ee||null===(te=ee.data)||void 0===te?void 0:te.items[0].objectType;const[se,ae]=(0,n.useState)(Q);console.log("Duplicate Initial Assigned Classes are:",se),(0,n.useEffect)((()=>{ae(Q),w(Q)}),[Q,ne]),(0,n.useEffect)((()=>{X||r()}),[X,r]),(0,n.useEffect)((()=>{N($)}),[$]);const re=(0,n.useMemo)((()=>(e=>{if(console.log("tableData in datahelpers",e),!e)return[];let t=e.map((e=>({Plant:e||"N/A"})));return t.sort(((e,t)=>e.Plant.localeCompare(t.Plant))),t})(f)),[f]),ie=(0,n.useMemo)((()=>(e=>e?e.map((e=>({"Available Plant":e||"N/A"}))):[])(b)),[b]);console.log("[Plant Assignment] Unique Table Data:",ie);const le=(0,n.useMemo)((()=>(e=>{if(!e||!e.cardData)return null;const t=e.cardData;let o={title:t.Title||"N/A",type:t.Type||"N/A","Maturity State":t["Maturity State"]||"N/A",owner:t.Owner||"N/A","Collaborative Space Title":t["Collaborative Space Title"]||"N/A",Description:t.Description||"N/A","Dropped Revision":t["Dropped Revision"]||"N/A","Latest Released Revision":t["Latest Released Revision"]||"N/A","CAD Format":t["CAD Format"]||"N/A",imageURL:t.imageURL||"".concat("https://oi000186152-us1-space.3dexperience.3ds.com/enovia","/snresources/images/icons/large/I_VPMNavProduct108x144.png")};return"Document"!==t.Type&&(o.EIN=t.EIN||"N/A",o["CAD Format"]=t["CAD Format"]||"N/A"),o})(J)),[J]);console.log(le),(0,n.useEffect)((()=>{re.length>=0&&(console.log("New Table Data:",re),h(re),B(JSON.parse(JSON.stringify(re))),d((e=>e+1)))}),[re]),(0,n.useEffect)((()=>{F(!!le)}),[le]);const ce=(0,n.useMemo)((()=>[{accessorKey:"Plant",header:"Plant"}]),[]),de=(0,n.useMemo)((()=>O),[]);console.log("Has Changes?",G);return(0,S.jsxs)(S.Fragment,{children:[D&&(0,S.jsx)(u.A,{}),(0,S.jsx)(k.A,{show:o,onHide:()=>s(!1),onConfirm:async()=>{s(!1),await(async()=>{const t=await y();(0,g.A)({"Content-Type":"application/json"},t),console.log("Confirmed remove logic running...");const o=K.map((e=>e.Plant)),n=o.map((e=>({title:e}))),s=p.filter((e=>!o.includes(e.Plant)));s&&(h(s),d((e=>e+1))),v((e=>[...e,...n])),e("Plants removed successfully.")})()}}),!X&&!i&&!x&&(0,S.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:(0,S.jsx)(L.A,{})}),X&&(0,S.jsxs)(S.Fragment,{children:[i&&(0,S.jsx)(u.A,{}),(0,S.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,S.jsxs)("div",{className:"d-flex ",children:[(0,S.jsx)("div",{className:" p-0 pt-4",children:(0,S.jsx)(I.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:()=>{r(),U((0,m.Rr)(!1)),U((0,m.um)({cardData:{},parentDetails:[],versions:[],initialDraggedData:[]})),U(),h([]),F(!1)}})}),le&&(0,S.jsx)(T.A,{data:le,widgetType:"PlantAssignment"})]})}),x?(0,S.jsx)("div",{className:"loading-indicator mt-5",children:(0,S.jsx)(u.A,{})}):(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{className:"wrapper-cta",children:[(0,S.jsx)(_,{uniquedata:ie,uniqueColumn:de,CAName:Z,onAddPlant:(e,t)=>{const o=e.map((e=>(0,g.A)((0,g.A)({},e),{},{preparedData:t,actionTag:"Add"})));console.log("Final Response:",o)},addedPlant:e=>{console.log("The data received from Child is:",e)},onSave:async()=>{console.log("OnSave is Called with the TableData",p)},onRemove:async()=>{s(!0),console.log("Remove button clicked, showing confirmation modal...")},state:oe,type:ne,hasChanges:G,onCancel:()=>{h(JSON.parse(JSON.stringify(z))),h(z),W(!1),q(!1),"Change Action"===ne&&C((e=>e.map((e=>(0,g.A)((0,g.A)({},e),{},{ItemPlants:e.ItemPlants.map((e=>(0,g.A)((0,g.A)({},e),{},{color:void 0})))})))))},setHasChanges:W}),(0,S.jsx)(R.A,{data:p,columns:ce,widgetType:"Plant_Assignment_Widget"},l)]})})]})]})};let q=null;function U(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let o=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");o||(o=document.createElement("div"),o.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(o):document.body.appendChild(o)),q||(q=s.createRoot(o)),q.render((0,S.jsxs)(a.Kq,{store:r.A,children:[(0,S.jsx)(E,{}),(0,S.jsx)(H,{}),(0,S.jsx)(i.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=541.00c99481.chunk.js.map